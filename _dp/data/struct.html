<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>表结构</title>
    <link href="/static/_dp/css/bootstrap.css" rel="stylesheet">
    <link href="/static/_dp/css/site.css" rel="stylesheet">
    <link href="/static/_dp/css/bg.css" rel="stylesheet">

<body>
<div class="wrap">
    <nav id="w0" class="navbar-inverse navbar-fixed-top navbar">
        <div class="container">
            <div class="navbar-header"></div>
            <div id="bg_menus_div" class="navbar-brand menus_root">导航</div>
            <div id="w0-collapse" class="collapse navbar-collapse">
                <ul id="w1" class="navbar-nav navbar-right nav">
                    <li><a href="/admin/dbdata/tables.html">所有表</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container">
        <script src="/static/_dp/js/hammer/kl-hammer.js"></script>
        <script src="/static/_dp/js/string/string.js"></script>
        <script src="/static/_dp/js/hammer-yii2/bootstrap.min.20211020.1.js?t=37778"></script>
        <script src="/static/_dp/js/hammer-yii2/datagrid/datagrid.min.20211020.1.js?t=53332"></script>
        <script src="/static/_dp/js/bg.js"></script>
        <script src="/static/file/struct/bi_input.js"></script>
        <script src="/static/_dp/js/db_struct.js"></script>
        <script src="/static/_dp/js/bi_items.js"></script>


        <div class="site-index">

            <div>

            </div>


            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="page-header" id="h1">【查询-数据】</h3>
                </div>
                <div class="panel-body">
                    <p id="subject_detail"></p>
                </div>
            </div>


            <div class="body-content" id="content_div">


            </div>

        </div>
        <script>

            domLoaded(function () {
                let utk = '';
                bg_init(function () {
                    utk = window.utk;
                    window.serverData.table = {};
                    window.serverData.columns = {};
                    window.serverData.vals_map = {};


                    kl.id('h1').textContent = kl.id('h1').textContent + '/' + serverData.table.title + '/ ' + window.serverData.table_name;
                    document.title = '【查】' + serverData.table.title + '/' + serverData.table.table_name;
                    kl.id('subject_detail').textContent = serverData.table.remark;

                    let root_div = new Emt('div');
                    kl.id('content_div').append(root_div);

                    let json_input_textarea = Emt('textarea');
                    let data_input_textarea = new Emt('textarea', '', '', {value: '{}'});
                    let data_out_textarea = new Emt('textarea');
                    let struct_div = new Emt('div');
                    let json_output_textarea = new Emt('textarea', 'readonly="readonly"');
                    let view_btn = new Emt('button', 'type="button"', '预览');
                    root_div.addNodes([
                        new Emt('div', 'class="json_div"').addNodes([
                            new Emt('h1', '', '结构json 输入'),
                            json_input_textarea
                        ]),
                        new Emt('div', 'class="json_div"').addNodes([
                            new Emt('h1', '', '数据json 输入'),
                            data_input_textarea
                        ]),
                        new Emt('div', 'class="view_div"').addNodes([
                            new Emt('h1', '', '结构展示'),
                            new Emt('p').addNodes([view_btn]),
                            struct_div
                        ]),
                        new Emt('div', 'class="json_div"').addNodes([
                            new Emt('h1', '', '结构json输出'),
                            json_output_textarea
                        ]),
                        new Emt('div', 'class="json_div"').addNodes([
                            new Emt('h1', '', '数据json输出'),
                            data_out_textarea
                        ]),
                    ]);


                    let bi_struct_ele = false;
                    view_btn.addEventListener('click', function () {
                        let tmp_struct_data = false;
                        let tmp_data = false;
                        try {
                            tmp_struct_data = JSON.parse(json_input_textarea.value);
                        } catch (e) {
                            alert('结构json 格式错误');
                            return false;
                        }
                        try {
                            tmp_data = JSON.parse(data_input_textarea.value);
                        } catch (e) {
                            alert('数据json 格式错误');
                            return false;
                        }

                        if (bi_struct_ele !== false) {
                            bi_struct_ele.remove();

                        }
                        bi_struct_ele = new biStruct(tmp_struct_data, tmp_data, function (val) {
                            data_out_textarea.value = JSON.stringify(val);
                        });
                        struct_div.addNode(bi_struct_ele);
                        json_output_textarea.value = JSON.stringify(tmp_struct_data);

                    });
                });


            });
        </script>
        <style>
            .container {
                width: 100% !important;
            }

            .hammer_input_option {
                display: none;
            }

            .table > thead > tr > th, .table > tbody > tr > th, .table > tfoot > tr > th, .table > thead > tr > td, .table > tbody > tr > td, .table > tfoot > tr > td {
                padding: 3px !important;
            }

            td > input[type="text"], td > input[type="number"], td > select {
                min-width: 45px !important;
                padding: 0 !important;
            }

            .view_div, .json_div, .view_div > textarea, .json_div > textarea {
                width: 100%;
                float: left;
                min-height: 200px;
            }

        </style>
        <script></script>
    </div>
</div>

<script>

</script>


<footer class="footer">
    <div class="container">
        <p class="pull-left">&copy; My Company 2022</p>

        <p class="pull-right">Powered by <a href="http://www.yiiframework.com/" rel="external">Yii Framework</a></p>
    </div>
</footer>

<script src="/static/_dp/js/jquery.js"></script>
<script src="/static/_dp/js/bootstrap.js"></script>
</body>
</html>

