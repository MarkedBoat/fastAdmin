<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>回滚用户资产操作</title>
    <link href="/static/file/admin/css/bootstrap.css" rel="stylesheet">
    <link href="/static/file/admin/css/site.css" rel="stylesheet">
    <link href="/static/file/admin/css/bg.css" rel="stylesheet">
</head>
<body>
<div class="wrap">
    <nav id="w0" class="navbar-inverse navbar-fixed-top navbar">
        <div class="container">
            <div class="navbar-header"></div>
            <div id="bg_menus_div" class="navbar-brand menus_root">回滚用户资产操作</div>
            <div id="w0-collapse" class="collapse navbar-collapse">
                <ul id="w1" class="navbar-nav navbar-right nav">

                </ul>
            </div>
        </div>
    </nav>
    <div class="container">
        <script src="/static/file/admin/js/hammer/kl-hammer.js"></script>
        <script src="/static/file/admin/js/string/string.js"></script>
        <script src="/static/file/admin/js/bg.js"></script>
        <script src="/static/file/admin/js/string/string.js"></script>

        <script src="/static/file/admin/js/hammer-yii2/bootstrap.min.2022.10.07.0.js"></script>
        <script src="/static/file/admin/js/hammer-yii2/datagrid/datagrid.min.2022.10.07.0.js"></script>


        <div class="site-index">

            <div>

            </div>


            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="page-header" id="h1">【回滚用户资产操作】</h3>
                </div>
                <div class="panel-body">
                    <p id="subject_detail"></p>
                </div>
            </div>


            <div class="body-content" id="content_div">


            </div>

        </div>
        <script>
            domLoaded(function () {


                let utk = '';
                bg_init(function () {
                    utk = window.utk;
                    content();
                });
                let content = function () {

                    let root_div = new Emt('div');
                    kl.id('content_div').append(root_div);

                    let hammerYii2Bootstarp1 = hammerYii2Bootstarp();
                    let form_edit = hammerYii2Bootstarp1.createForm({dataNameTpl: 'attr[$var]'});
                    root_div.addNode(form_edit);


                    form_edit.apiHandle.addGroupPreCreate().setLabelText('历史id').setIndexKey('his_id').create('number');


                    form_edit.apiHandle.addGroupPreCreate().setLabelText('原因').setPlaceHolder('原因').setIndexKey('reason').setNameVar('reason').create('textarea');


                    form_edit.apiHandle.addGroupPreCreate().setLabelText('资产类型').setIndexKey('item_flag').setNameVar('item_flag').setItems([
                        {text: '通货', val: 'currency'},
                    ]).create('select');
                    let item_flag_input = form_edit.apiHandle.ele.input.item_flag;

                    form_edit.apiHandle.addGroupPreCreate().setType('button').setContentText('保存').setIndexKey('submit').setClickCall(function (btn) {
                        console.log(item_flag_input, item_flag_input.apiHandle.getVal());

                        kl.ajax({
                            url: '/bee_invasion/v1/admin/bizuser/assetsRollback?user_token=' + utk,
                            data: {
                                his_id: form_edit.apiHandle.ele.input.his_id.apiHandle.getVal(),
                                reason: form_edit.apiHandle.ele.input.reason.apiHandle.getVal(),
                                item_class: item_flag_input.apiHandle.getVal(),
                            },
                            type: 'json',
                            success: function (res_save_column) {
                                if (res_save_column.status) {
                                    if (res_save_column.status === 200) {
                                        alert('成功');
                                    } else {
                                        alert('错误:' + (res_save_column.msg || '未知'))
                                    }
                                } else {
                                    console.log(res_save_column);
                                    alert('请求结果异常')
                                }
                            },
                            error: function (res_save_column) {
                                console.log(res_save_column);
                                alert('网络异常');
                            }
                        })
                    }).create('button');


                };


            });

        </script>
        <style>

        </style>
    </div>
</div>


<script src="/static/file/admin/js/jquery.js"></script>
<script src="/static/file/admin/js/bootstrap.js"></script>
</body>
</html>
