<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>修改用户资产</title>
    <link href="/static/file/admin/css/bootstrap.css" rel="stylesheet">
    <link href="/static/file/admin/css/site.css" rel="stylesheet">
    <link href="/static/file/admin/css/bg.css" rel="stylesheet">
</head>
<body>
<div class="wrap">
    <nav id="w0" class="navbar-inverse navbar-fixed-top navbar">
        <div class="container">
            <div class="navbar-header"></div>
            <div id="bg_menus_div" class="navbar-brand menus_root">修改用户资产</div>
            <div id="w0-collapse" class="collapse navbar-collapse">
                <ul id="w1" class="navbar-nav navbar-right nav">

                </ul>
            </div>
        </div>
    </nav>
    <div class="container">
        <script src="/static/file/admin/js/hammer/kl-hammer.js"></script>
        <script src="/static/file/admin/js/string/string.js"></script>
        <script src="/static/file/admin/js/bg.js"></script>
        <script src="/static/file/admin/js/string/string.js"></script>

        <script src="/static/file/admin/js/hammer-yii2/bootstrap.min.2022.10.07.0.js"></script>
        <script src="/static/file/admin/js/hammer-yii2/datagrid/datagrid.min.2022.10.07.0.js"></script>


        <div class="site-index">

            <div>

            </div>


            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="page-header" id="h1">【修改用户资产】</h3>
                </div>
                <div class="panel-body">
                    <p id="subject_detail"></p>
                </div>
            </div>


            <div class="body-content" id="content_div">


            </div>

        </div>
        <script>
            domLoaded(function () {


                let utk = '';
                bg_init(function () {
                    utk = window.utk;
                    content();
                });
                let content = function () {

                    let root_div = new Emt('div');
                    kl.id('content_div').append(root_div);

                    let hammerYii2Bootstarp1 = hammerYii2Bootstarp();
                    let form_edit = hammerYii2Bootstarp1.createForm({dataNameTpl: 'attr[$var]'});
                    root_div.addNode(form_edit);


                    form_edit.apiHandle.addGroupPreCreate().setLabelText('业务用户id').setIndexKey('biz_user_id').create('number');

                    form_edit.apiHandle.addGroupPreCreate().setLabelText('理由').setPlaceHolder('不可重复').setIndexKey('op_flag').create('text');


                    form_edit.apiHandle.addGroupPreCreate().setLabelText('详细描述').setPlaceHolder('备注').setIndexKey('op_detail').setNameVar('remark').create('textarea');


                    form_edit.apiHandle.addGroupPreCreate().setLabelText('资产类型').setIndexKey('item_flag').setNameVar('item_flag').setItems([
                        {text: '通货/元宝', val: 'currency/gold_ingot'},
                        {text: '通货/金币', val: 'currency/gold_coin'},
                        {text: '通货/分数', val: 'currency/points'},
                        {text: '通货/普通碎片', val: 'currency/lev_1_fragment'},
                        {text: '通货/vip碎片', val: 'currency/vip_fragment'},
                        {text: '通货/门票', val: 'currency/vip_channel_ticket'},
                    ]).create('select');
                    let item_flag_input = form_edit.apiHandle.ele.input.item_flag;


                    // let handle_out_datatype_select = hammerYii2Bootstarp1.select({list: ['string', 'int', 'date', 'img_uri']});
                    //let handle_in_datatype_select = hammerYii2Bootstarp1.select({list: ['string', 'int', 'date']});


                    //let handle_vals_range_textarea = hammerYii2Bootstarp1.textarea({});
                    //let column_vals_range = handle_form_edit.createInputTextArea('取值范围', '代表值对应含义', 'input_val_range_ele', 'val_range').input_val_range_ele;
                    form_edit.apiHandle.addGroupPreCreate().setLabelText('数量').setIndexKey('item_amount').create('number');
                    let item_amount_input = form_edit.apiHandle.ele.input.item_amount;

                    form_edit.apiHandle.addGroupPreCreate().setType('button').setContentText('保存').setIndexKey('submit').setClickCall(function (btn) {
                        console.log(item_flag_input, item_flag_input.apiHandle.getVal());
                        let tmp_ar = item_flag_input.apiHandle.getVal().split('/');
                      //  let tmp_val = parseFloat(form_edit.apiHandle.ele.input.item_amount.apiHandle.getVal()) * Math.pow(8, 10);
                        let tmp_val = form_edit.apiHandle.ele.input.item_amount.apiHandle.getVal() * Math.pow(10, 8);
                        if (tmp_val.toString().indexOf('.') > 0) {
                            alert('浮点类型转化结果异常:' + tmp_val + ',请尝试补0或者去0');
                            throw '错误值，不能使用';
                        }
                        kl.ajax({
                            url: '/bee_invasion/v1/admin/bizuser/opAssets?user_token=' + utk,
                            data: {
                                biz_user_id: form_edit.apiHandle.ele.input.biz_user_id.apiHandle.getVal(),
                                op_flag: form_edit.apiHandle.ele.input.op_flag.apiHandle.getVal(),
                                op_detail: form_edit.apiHandle.ele.input.op_detail.apiHandle.getVal(),
                                item_class: tmp_ar[0],
                                item_code: tmp_ar[1],
                                item_amount: tmp_val,
                            },
                            type: 'json',
                            success: function (res_save_column) {
                                if (res_save_column.status) {
                                    if (res_save_column.status === 200) {
                                        alert('成功');
                                    } else {
                                        alert('错误:' + (res_save_column.msg || '未知'))
                                    }
                                } else {
                                    console.log(res_save_column);
                                    alert('请求结果异常')
                                }
                            },
                            error: function (res_save_column) {
                                console.log(res_save_column);
                                alert('网络异常');
                            }
                        })
                    }).create('button');


                };


            });

        </script>
        <style>

        </style>
    </div>
</div>


<script src="/static/file/admin/js/jquery.js"></script>
<script src="/static/file/admin/js/bootstrap.js"></script>
</body>
</html>
